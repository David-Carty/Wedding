

document.addEventListener('DOMContentLoaded', function () {

    /***** Load Main Gallery */

    var mainGallery = document.getElementById("main-gallery");
    loadHTML("view_SlideGallery.html", mainGallery, function () {

        jQuery.loadScript = function (url, callback) {
            jQuery.ajax({
                url: url,
                dataType: 'script',
                success: callback,
                async: true
            });
        }
        $.loadScript("fotorama.js", function () {
            //Stuff to do after someScript has loaded
            /*         $('.fotorama').fotorama({
         
                         maxwidth: '95%',
         
                         allowfullscreen: true,
                         margins: 20
         
                     }); */
        });
    });

    /***** End Main Load Galley */

    /***** Load Listview Gallery */
    var imList = document.getElementById("image-list");
    loadHTML("view_ImageList.html", imList, function () {
        jQuery.loadScript = function (url, callback) {
            jQuery.ajax({
                url: url,
                dataType: 'script',
                success: callback,
                async: true
            });
        }
        $.loadScript("dropdown.js", function () {
            //Stuff to do after someScript has loaded

        });
    });



    /***** End Load Listview Gallery */


    setTimeout(function () {


        document.getElementById('login-slidedown').classList.add('slideDown');

        setTimeout(function () {
            var pinMessage = document.getElementById("passcode-msg")
            pinMessage.classList.remove("hidden")
            pinMessage.classList.add("fadeIn")

            setTimeout(function () {
                pinMessage.classList.add("fadeOut")

                setTimeout(function () {
                    var loginPins = document.getElementById("login")

                    loginPins.classList.add("fadeIn")
                    pinMessage.classList.add("hidden")
                    loginPins.style.opacity = 1;
                }, 200); /*2000 */
            }, 200); /* 2000 */
        }, 40); /*400 yes 400 */

    }, 100); /*1000 */
}, false);


var pinInputs = document.querySelectorAll('.pin');

for (var i = 0; i < pinInputs.length; i++) {
    pinInputs[i].addEventListener("change", function () {
        var count = 0;
        var PinEntered = ""
        for (var j = 0; j < pinInputs.length; j++) {
            if (pinInputs[j].value !== "") {
                PinEntered += pinInputs[j].value;
                count += 1;
                if (count < 4) {
                    PinEntered += ","
                }
            }
        }
        if (count === 4) { /* Correct PIN entered. */
            if (validate(PinEntered)) {
                var loginBack = document.querySelector('.login-back');
                loginBack.classList.add("fadeOut");
                setTimeout(function () { document.activeElement.blur(); loginBack.classList.add("hidden"); loginBack.classList.remove("fadeOut"); }, 2000);


            } else {
                for (var j = 0; j < pinInputs.length; j++) {
                    pinInputs[j].value = "";
                    count += 1;
                }
            }

        }
    }, false);
}


function screenIsWide() {
    var mq = window.matchMedia("(min-width: 780px)");
    return mq.matches;
}

function screenIsPortrait() {
    var mq = window.matchMedia("(orientation:portrait)");
    return mq.matches;
}



function mediaChanged() {

    // media query event handler
    if (matchMedia) {

        var slideDown = document.getElementById("login-slidedown");
        var loginWrap = document.querySelector(".login-wrap");

        var loginHeader = document.querySelector(".login-header");
        var loginFooter = document.querySelector(".login-footer");
        var weddingCaption = document.querySelector(".wedding-caption");

        if (screenIsWide() || !screenIsPortrait()) {
            //alert("screenIsLandscape()=" + screenIsLandscape())
            // window width is at least 780px or landscape
            loginWrap.appendChild(slideDown);
            //document.getElementById('pin1').focus();
            weddingCaption.innerHTML = "Therese & Anders Södertuna Slott 191026."
            loginHeader.appendChild(weddingCaption);
        } else {
            /* smaller than 780 or portrait */
            loginFooter.appendChild(slideDown);
            weddingCaption.innerHTML = "Therese & Anders<br>Södertuna Slott<br>191026."
            loginFooter.appendChild(weddingCaption);
        }

    }
}

mediaChanged();

//var mql = window.matchMedia('(max-width: 780px)');
//mql.addEventListener("change", function () { alert("changed"); mediaChanged(); }, false);
//var mq = window.matchMedia("(min-width: 780px)");
//mq.addListener(mediaChanged);

var mqls = [ // list of window.matchMedia() queries
    window.matchMedia("(max-width: 780px)")
]

for (var i = 0; i < mqls.length; i++) { // loop through queries
    mqls[i].addListener(mediaChanged) // call handler function whenever the media query is triggered
}



function autotab(current, to) {
    if (current.getAttribute && current.value.length == current.getAttribute("maxlength")) {
        to.focus()
    }
}


function validate(p) {

    count = 0;
    tot = 0;
    var key = [0, 0, 6, 6, 4, 8, 9, 8, 6, 9, 1, 7, 9, 13, 3, 90, 6, 2, 4, 9, 1, 81, 7, 7, 4, 9, 2, 17, 87, 45, 2, 19, 8, 44];
    var ps = p.split(",");
    for (var i = 0; i < ps.length; i++) {
        var t = parseInt(ps[i])
        if (key[t] == t) {
            count += 1;
            tot += t;

        }
    }
    if (count === 4) {
        if (key[tot] === tot && tot > 12) {

            return true;
        }
    }
    return false;
}