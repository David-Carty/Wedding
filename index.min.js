/* Very important polyfil for closest */
if (!Element.prototype.matches) {
    Element.prototype.matches = Element.prototype.msMatchesSelector ||
        Element.prototype.webkitMatchesSelector;
}

if (!Element.prototype.closest) {
    Element.prototype.closest = function (s) {
        var el = this;

        do {
            if (el.matches(s)) return el;
            el = el.parentElement || el.parentNode;
        } while (el !== null && el.nodeType === 1);
        return null;
    };
}
/* matchMedia Polyfill  */

window.matchMedia || (window.matchMedia = function () { "use strict"; var e = window.styleMedia || window.media; if (!e) { var t, d = document.createElement("style"), i = document.getElementsByTagName("script")[0]; d.type = "text/css", d.id = "matchmediajs-test", i ? i.parentNode.insertBefore(d, i) : document.head.appendChild(d), t = "getComputedStyle" in window && window.getComputedStyle(d, null) || d.currentStyle, e = { matchMedium: function (e) { var i = "@media " + e + "{ #matchmediajs-test { width: 1px; } }"; return d.styleSheet ? d.styleSheet.cssText = i : d.textContent = i, "1px" === t.width } } } return function (t) { return { matches: e.matchMedium(t || "all"), media: t || "all" } } }());




/*document.addEventListener('click', function (e) {
    var ImLis = document.getElementById("image-list")
    ImLis.classList.remove("open")
} */

var fotorama

setTimeout(function () {

    var $fotoramaDiv = $('#fotorama').fotorama({ arrows: false });


    fotorama = $fotoramaDiv.data('fotorama');
    console.log(fotorama);
    var leftNav = document.getElementById("left-nav")
    var rightNav = document.getElementById("right-nav")

    leftNav.addEventListener('click', function (e) {
        fotorama.show('<');
    });

    rightNav.addEventListener('click', function (e) {
        fotorama.show('>');
    });

    var darkTheme = document.getElementById('swatch-dark');
    var lightTheme = document.getElementById('swatch-light');
    var body = document.getElementsByTagName("BODY")[0];

    darkTheme.addEventListener('click', function (e) {
        body.classList.remove("dark", "light");
        body.classList.add("dark");
    });

    lightTheme.addEventListener('click', function (e) {
        body.classList.remove("dark", "light");
        body.classList.add("light");
    });

}, 500);

document.addEventListener('click', function (e) {
    /* Event Delegation use this and closest polyfil moving forward. */

    var showList = e.target.closest('.open-list-view');
    var exitApp = e.target.closest('.exit-application');
    var closeSlideUp = e.target.closest('.x');
    /* Event Delegation use this and closest polyfil moving forward. */
    var effectsEl = e.target.closest('.effect');
    var swatchEl = e.target.closest('.swatch-outer');
    var showList = e.target.closest('.open-list-view');


    var imgListSlider = document.getElementById("image-list");
    if (showList) {
        //imgListSlider.style.display = "block";
        imgListSlider.classList.add("open");

    }
    if (exitApp) {

        if (confirm("Bekr√§fta finish?")) {
            var pinInputs = document.querySelectorAll('.pin');
            for (var j = 0; j < pinInputs.length; j++) {
                pinInputs[j].value = "";
            }
            var loginBack = document.querySelector('.login-back');
            loginBack.classList.add("fadeIn");
            loginBack.classList.remove("hidden");
            setTimeout(function () { loginBack.classList.remove("fadeIn"); }, 2000);
        }
    }

    if (effectsEl) {
        applyEffect(effectsEl);
    }

    if (swatchEl) {
        applySwatch(swatchEl);
    }
    if (closeSlideUp) {
        var ImLis = document.getElementById("image-list")
        ImLis.classList.remove("open")
    }


}, true);

setTimeout(function () {
    var thums = document.querySelectorAll('.thum');

    for (var i = 0; i < thums.length; i++) {

        thums[i].addEventListener("click", function (e) {

            var ImLis = document.getElementById("image-list")
            var indx = parseInt($(this).attr('data-indx'));
            //alert("indx=" + indx);
            fotorama.show(indx);
            ImLis.classList.remove("open")
        })
    }

}, 4000);

function loadHTML(url, containerObj, callbackFn) {
    /* If a container is specified it must always be as a container object and not id for performance. */
    var xhttp = new XMLHttpRequest();
    var retVal = true;
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            containerObj.innerHTML = this.responseText;
        } else {
            retVal = "error status:" + this.status;
        }

    };
    xhttp.open("GET", url, true);
    xhttp.send();
    callbackFn(retVal);
}

